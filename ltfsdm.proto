syntax = "proto2";

package LTFSDmProtocol;

message LTFSDmReqNumber {
	required uint64 key = 1;
}

message LTFSDmReqNumberResp {
	required bool success = 1;
	required int64 reqNumber = 2;
}

message LTFSDmMigRequest {
	required uint64 key = 1;
	required uint64 reqNumber = 2;
	required uint64 pid = 3;

	enum State {
		PREMIGRATED = 0;
		MIGRATED = 1;
	}
	required State state = 4;

	message FileName {
		required string filename = 1;
	}

	repeated FileName filenames = 5;
}

message LTFSDmMigRequestResp {
	required bool success = 1;
	required uint64 reqNumber = 2;
	required int64 pid = 3;
}

message LTFSDmSelRecRequest {
	required uint64 key = 1;
	required uint64 reqNumber = 2;
	enum State {
		PREMIGRATED = 0;
		MIGRATED = 1;
	}
	required State state = 3;

	message FileName {
		required string filename = 1;
	}

	repeated FileName filenames = 4;
}

message LTFSDmTransRecRequest {
	required uint64 key = 1;
	required uint64 reqNumber = 2;
	enum State {
		PREMIGRATED = 0;
		MIGRATED = 1;
	}
	required State state = 3;
	required uint64 fsid = 4;
	required uint64 igen = 5;
	required uint64 inum = 6;
}

message LTFSDmStopRequest {
	required uint64 key = 1;
	required int64 reqNumber = 2;
}

message LTFSDmStopResp {
	required bool success = 1;
}

message Command {
	oneof commands {
		LTFSDmReqNumber reqnum = 1;
		LTFSDmReqNumberResp reqnumresp = 2;
		LTFSDmMigRequest migrequest = 3;
		LTFSDmMigRequestResp migrequestresp = 4;
		LTFSDmSelRecRequest selrecrequest = 5;
		LTFSDmTransRecRequest transrecrequest = 6;
		LTFSDmStopRequest stoprequest = 7;
		LTFSDmStopResp stopresp = 8;
	}
}
